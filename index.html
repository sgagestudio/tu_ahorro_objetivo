<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Objetivo de Ahorro ‚Äî 15.000‚Ç¨/a√±o</title>
  <style>
    :root{
      --bg: #0b1220;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.085);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.65);
      --line: rgba(255,255,255,.12);
      --good:#34d399;
      --bad:#fb7185;
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --radius: 18px;
      --radius2: 14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 15% 15%, rgba(167,139,250,.25), transparent 60%),
        radial-gradient(900px 500px at 80% 20%, rgba(110,231,255,.20), transparent 55%),
        radial-gradient(900px 600px at 45% 95%, rgba(52,211,153,.12), transparent 60%),
        var(--bg);
      min-height:100vh;
    }

    header{
      padding: 28px 18px 8px;
      max-width: 1100px;
      margin: 0 auto;
    }

    .title{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }

    h1{
      margin:0;
      font-size: clamp(22px, 3vw, 34px);
      letter-spacing: .2px;
    }

    .subtitle{
      margin: 8px 0 0;
      color: var(--muted);
      line-height:1.35;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(110,231,255,.18), rgba(167,139,250,.16));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      font-weight: 600;
      color: rgba(255,255,255,.9);
      white-space:nowrap;
    }

    main{
      max-width: 1100px;
      margin: 0 auto;
      padding: 14px 18px 48px;
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 14px;
    }

    @media (max-width: 980px){
      main{ grid-template-columns: 1fr; }
    }

    .card{
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,.04));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .card .hd{
      padding: 16px 16px 12px;
      border-bottom: 1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .card .hd h2{
      margin:0;
      font-size: 16px;
      letter-spacing:.2px;
    }

    .card .bd{
      padding: 16px;
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    @media (max-width: 700px){
      .grid2{ grid-template-columns: 1fr; }
    }

    .kpi{
      background: linear-gradient(180deg, var(--card2), rgba(255,255,255,.04));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: var(--radius2);
      padding: 12px 12px;
    }
    .kpi .label{
      color: var(--muted);
      font-size: 12px;
      margin-bottom: 6px;
    }
    .kpi .value{
      font-size: 18px;
      font-weight: 750;
      letter-spacing: .2px;
    }

    .progressWrap{ margin-top: 12px; }
    .progressTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      margin-bottom: 8px;
      color: var(--muted);
      font-size: 12.5px;
    }

    .bar{
      height: 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.10);
      overflow:hidden;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.10);
    }

    .bar > div{
      height:100%;
      width:0%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(52,211,153,.95), rgba(110,231,255,.95), rgba(167,139,250,.95));
      box-shadow: 0 10px 30px rgba(110,231,255,.12);
      transition: width .35s ease;
    }

    .hint{
      margin-top: 10px;
      color: var(--muted);
      font-size: 13px;
      line-height:1.35;
    }

    form{ display:grid; gap: 10px; }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 700px){
      .row{ grid-template-columns: 1fr; }
    }

    label{
      display:grid;
      gap: 6px;
      font-size: 12px;
      color: var(--muted);
    }

    input, select, button, textarea{
      font: inherit;
      color: var(--text);
    }

    input, select, textarea{
      padding: 11px 12px;
      border-radius: 12px;
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.12);
      outline: none;
      transition: border-color .15s ease, transform .08s ease;
    }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(110,231,255,.55);
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 4px;
    }

    button{
      border: 0;
      cursor: pointer;
      padding: 11px 12px;
      border-radius: 12px;
      font-weight: 750;
      letter-spacing:.2px;
      box-shadow: 0 14px 35px rgba(0,0,0,.35);
      transition: transform .08s ease, filter .15s ease;
    }
    button:active{ transform: translateY(1px); }

    .btnGood{
      background: linear-gradient(90deg, rgba(52,211,153,.95), rgba(110,231,255,.85));
      color: rgba(0,0,0,.75);
    }
    .btnBad{
      background: linear-gradient(90deg, rgba(251,113,133,.95), rgba(251,191,36,.72));
      color: rgba(0,0,0,.75);
    }
    .btnGhost{
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.9);
      box-shadow:none;
    }

    table{
      width:100%;
      border-collapse: collapse;
      overflow:hidden;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
    }

    th, td{
      padding: 10px 10px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      font-size: 13px;
      vertical-align: top;
    }
    th{
      text-align:left;
      color: rgba(255,255,255,.78);
      font-size: 12px;
      letter-spacing: .15px;
      background: rgba(255,255,255,.06);
    }

    .amt.pos{ color: var(--good); font-weight: 750; }
    .amt.neg{ color: var(--bad); font-weight: 750; }

    .mini{
      font-size: 12px;
      color: var(--muted);
      margin-top: 10px;
      line-height:1.35;
    }

    .dbBox{ display:grid; gap:10px; }

    textarea{
      min-height: 220px;
      resize: vertical;
      font-family: var(--mono);
      font-size: 12.5px;
      line-height: 1.35;
    }

    .toast{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(0,0,0,.28);
      border: 1px solid rgba(255,255,255,.12);
      color: var(--muted);
      font-size: 12.5px;
      display:none;
    }

    .muted{ color: var(--muted); }
    .ok{ color: var(--good); }
    .danger{ color: var(--bad); }
  </style>
</head>

<body>
  <header>
    <div class="title">
      <div>
        <h1>Objetivo de ahorro</h1>
        <p class="subtitle">Seguimiento simple de ingresos y gastos con c√°lculo en tiempo real para llegar a <b>15.000‚Ç¨</b> al a√±o.</p>
      </div>
      <div class="pill" id="yearPill">A√±o ‚Äî</div>
    </div>
  </header>

  <main>
    <!-- IZQUIERDA -->
    <section class="card">
      <div class="hd">
        <h2>Resumen</h2>
        <span class="muted" id="asOf">‚Äî</span>
      </div>
      <div class="bd">
        <div class="grid2">
          <div class="kpi">
            <div class="label">Objetivo anual</div>
            <div class="value" id="goalKpi">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="label">Ahorro neto (ingresos ‚àí gastos)</div>
            <div class="value" id="netKpi">‚Äî</div>
          </div>

          <div class="kpi">
            <div class="label">Total ingresos</div>
            <div class="value" id="incomeKpi">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="label">Total gastos</div>
            <div class="value" id="expenseKpi">‚Äî</div>
          </div>
        </div>

        <div class="progressWrap">
          <div class="progressTop">
            <span id="progressText">Progreso ‚Äî</span>
            <span id="remainingText">Faltan ‚Äî</span>
          </div>
          <div class="bar" aria-label="Barra de progreso">
            <div id="barFill"></div>
          </div>
          <div class="hint" id="rateHint">‚Äî</div>
        </div>

        <hr style="border:0;border-top:1px solid var(--line);margin:16px 0;" />

        <div class="hd" style="padding:0 0 10px;border:none;">
          <h2>Nuevo movimiento</h2>
        </div>

        <form id="txForm">
          <div class="row">
            <label>
              Tipo
              <select id="type">
                <option value="income">Ingreso</option>
                <option value="expense">Gasto</option>
              </select>
            </label>
            <label>
              Fecha
              <input id="date" type="date" required />
            </label>
          </div>

          <div class="row">
            <label>
              Concepto
              <input id="desc" type="text" placeholder="Ej: N√≥mina, compra, alquiler..." maxlength="80" />
            </label>
            <label>
              Importe (‚Ç¨)
              <input id="amount" type="number" step="0.01" min="0" placeholder="0.00" required />
            </label>
          </div>

          <div class="actions">
            <button type="submit" class="btnGood">A√±adir</button>
            <button type="button" class="btnGhost" id="clearBtn">Borrar todo</button>
          </div>

          <div class="toast" id="toast"></div>
        </form>

        <hr style="border:0;border-top:1px solid var(--line);margin:16px 0;" />

        <div class="hd" style="padding:0 0 10px;border:none;">
          <h2>Movimientos</h2>
          <span class="muted" id="countTx">‚Äî</span>
        </div>

        <div style="overflow:auto;">
          <table>
            <thead>
              <tr>
                <th style="min-width:110px;">Fecha</th>
                <th style="min-width:110px;">Tipo</th>
                <th>Concepto</th>
                <th style="min-width:120px;text-align:right;">Importe</th>
                <th style="min-width:90px;text-align:right;">Acci√≥n</th>
              </tr>
            </thead>
            <tbody id="txBody"></tbody>
          </table>
        </div>

        <div class="mini">
          Los datos se guardan en <b>localStorage</b> (solo en este dispositivo/navegador).
        </div>
      </div>
    </section>

    <!-- DERECHA -->
    <aside class="card">
      <div class="hd">
        <h2>Base de datos (texto dentro de la web)</h2>
        <span class="muted">JSON</span>
      </div>
      <div class="bd">
        <div class="dbBox">
          <div class="muted" style="font-size:13px;line-height:1.35;">
            Esta ‚Äúhoja de texto‚Äù refleja tu base de datos. Puedes copiar/pegar como backup o editar y luego importar.
          </div>

          <textarea id="dbText" spellcheck="false"></textarea>

          <div class="actions">
            <button type="button" class="btnGhost" id="exportBtn">Refrescar texto</button>
            <button type="button" class="btnGood" id="importBtn">Importar desde texto</button>
            <button type="button" class="btnBad" id="resetBtn">Reset demo</button>
          </div>

          <div class="mini">
            Formato: array JSON de objetos <span style="font-family:var(--mono);">{"id","type","date","desc","amount"}</span>
          </div>
        </div>
      </div>
    </aside>
  </main>

  <script>
    // ===== Config =====
    const GOAL_YEAR = 15000; // objetivo anual fijo
    const STORAGE_KEY = "ahorro_db_v1";

    // ===== State =====
    /** @type {{id:string,type:"income"|"expense",date:string,desc:string,amount:number}[]} */
    let db = [];

    // ===== Helpers =====
    const ‚Ç¨ = (n) => Number(n || 0).toLocaleString("es-ES", { style:"currency", currency:"EUR" });
    const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
    const uid = () => Math.random().toString(16).slice(2) + "-" + Date.now().toString(16);

    const todayISO = () => {
      const d = new Date();
      const pad = (x) => String(x).padStart(2,"0");
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    };

    const endOfYear = (year) => new Date(year, 11, 31, 23, 59, 59);

    const daysBetween = (a, b) => {
      const ms = b.getTime() - a.getTime();
      return Math.max(0, Math.ceil(ms / (1000*60*60*24)));
    };

    function toast(msg, kind="info"){
      const el = document.getElementById("toast");
      el.style.display = "block";
      el.textContent = msg;
      el.style.borderColor =
        kind === "ok" ? "rgba(52,211,153,.35)" :
        kind === "bad" ? "rgba(251,113,133,.40)" :
        "rgba(255,255,255,.14)";
      clearTimeout(toast._t);
      toast._t = setTimeout(()=>{ el.style.display="none"; }, 2600);
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ===== Persistence (localStorage) =====
    function save(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
      refreshDbText(false);
    }

    function load(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(raw){
        try{
          const parsed = JSON.parse(raw);
          if(Array.isArray(parsed)) db = sanitize(parsed);
          else db = [];
        }catch{
          db = [];
        }
      } else {
        // demo inicial
        db = [
          { id: uid(), type:"income", date: todayISO(), desc:"Ingreso demo", amount: 1200 },
          { id: uid(), type:"expense", date: todayISO(), desc:"Alquiler demo", amount: 550 },
          { id: uid(), type:"expense", date: todayISO(), desc:"Compra demo", amount: 85.40 }
        ];
        save();
      }
    }

    function sanitize(arr){
      const out = [];
      for(const x of arr){
        if(!x || typeof x !== "object") continue;
        const type = (x.type === "expense") ? "expense" : "income";
        const date = (typeof x.date === "string" && /^\d{4}-\d{2}-\d{2}$/.test(x.date)) ? x.date : todayISO();
        const desc = (typeof x.desc === "string") ? x.desc.slice(0,80) : "";
        const amount = Number(x.amount);
        if(!Number.isFinite(amount) || amount < 0) continue;
        out.push({
          id: (x.id && typeof x.id === "string") ? x.id : uid(),
          type, date, desc,
          amount: Math.round(amount*100)/100
        });
      }
      return out;
    }

    // ===== Calculations =====
    function totals(){
      let income = 0, expense = 0;
      for(const t of db){
        if(t.type === "income") income += t.amount;
        else expense += t.amount;
      }
      income = Math.round(income*100)/100;
      expense = Math.round(expense*100)/100;
      const net = Math.round((income - expense)*100)/100;
      return { income, expense, net };
    }

    function requiredRates(net){
      const now = new Date();
      const year = now.getFullYear();
      const eoy = endOfYear(year);

      const remaining = Math.max(0, GOAL_YEAR - net);
      const remainingDays = Math.max(1, daysBetween(now, eoy)); // evita dividir por 0

      const perDay = remaining / remainingDays;
      const perWeek = perDay * 7;

      const avgMonthDays = 365.2425 / 12; // ~30.44
      const perMonth = remaining / (remainingDays / avgMonthDays);

      return {
        year,
        remaining,
        remainingDays,
        perDay,
        perWeek,
        perMonth
      };
    }

    // ===== Render =====
    function render(){
      const { income, expense, net } = totals();
      const r = requiredRates(net);

      document.getElementById("yearPill").textContent = `A√±o ${r.year} ‚Äî objetivo ${‚Ç¨(GOAL_YEAR)}`;
      document.getElementById("asOf").textContent = `Actualizado: ${new Date().toLocaleString("es-ES")}`;

      document.getElementById("goalKpi").textContent = ‚Ç¨(GOAL_YEAR);
      document.getElementById("netKpi").textContent = ‚Ç¨(net);
      document.getElementById("incomeKpi").textContent = ‚Ç¨(income);
      document.getElementById("expenseKpi").textContent = ‚Ç¨(expense);

      const pct = clamp((net / GOAL_YEAR) * 100, 0, 100);
      document.getElementById("barFill").style.width = `${pct}%`;
      document.getElementById("progressText").textContent = `Progreso: ${pct.toFixed(1)}%`;

      const remainingText = (GOAL_YEAR - net);
      document.getElementById("remainingText").textContent =
        remainingText <= 0 ? "Objetivo alcanzado üéâ" : `Faltan ${‚Ç¨(remainingText)}`;

      const hintEl = document.getElementById("rateHint");
      if(remainingText <= 0){
        hintEl.innerHTML = `<span class="ok"><b>¬°Ya has alcanzado el objetivo anual!</b></span>`;
      }else{
        hintEl.innerHTML =
          `Te faltan <b>${‚Ç¨(r.remaining)}</b> en <b>${r.remainingDays}</b> d√≠as. ` +
          `Media necesaria: <b>${‚Ç¨(r.perDay)}</b>/d√≠a ¬∑ <b>${‚Ç¨(r.perWeek)}</b>/semana ¬∑ <b>${‚Ç¨(r.perMonth)}</b>/mes.`;
      }

      const body = document.getElementById("txBody");
      body.innerHTML = "";

      const sorted = [...db].sort((a,b)=> (a.date < b.date ? 1 : a.date > b.date ? -1 : 0));
      for(const t of sorted){
        const tr = document.createElement("tr");
        const typeLabel = t.type === "income" ? "Ingreso" : "Gasto";
        const amtClass = t.type === "income" ? "pos" : "neg";
        const sign = t.type === "income" ? "+" : "‚àí";

        tr.innerHTML = `
          <td>${t.date}</td>
          <td>${typeLabel}</td>
          <td>${escapeHtml(t.desc || "")}</td>
          <td style="text-align:right;"><span class="amt ${amtClass}">${sign} ${‚Ç¨(t.amount)}</span></td>
          <td style="text-align:right;">
            <button class="btnGhost" data-del="${t.id}" style="padding:8px 10px;border-radius:10px;">Borrar</button>
          </td>
        `;
        body.appendChild(tr);
      }

      document.getElementById("countTx").textContent = `${db.length} mov.`;

      body.querySelectorAll("button[data-del]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-del");
          db = db.filter(x => x.id !== id);
          save();
          render();
        });
      });

      refreshDbText(false);
    }

    // ===== DB text area =====
    function refreshDbText(showToast=true){
      const ta = document.getElementById("dbText");
      ta.value = JSON.stringify(db, null, 2);
      if(showToast) toast("Texto actualizado.", "ok");
    }

    function importFromText(){
      const ta = document.getElementById("dbText");
      try{
        const parsed = JSON.parse(ta.value);
        if(!Array.isArray(parsed)) throw new Error("El JSON debe ser una lista (array).");
        db = sanitize(parsed);
        save();
        render();
        toast("Importaci√≥n correcta ‚úÖ", "ok");
      }catch(e){
        toast(`No se pudo importar: ${e.message}`, "bad");
      }
    }

    // ===== Events =====
    document.getElementById("date").value = todayISO();

    document.getElementById("txForm").addEventListener("submit", (ev)=>{
      ev.preventDefault();

      const type = document.getElementById("type").value;
      const date = document.getElementById("date").value || todayISO();
      const desc = (document.getElementById("desc").value || "").trim();
      const amount = Number(document.getElementById("amount").value);

      if(!Number.isFinite(amount) || amount <= 0){
        toast("Introduce un importe v√°lido (> 0).", "bad");
        return;
      }

      db.push({
        id: uid(),
        type: (type === "expense") ? "expense" : "income",
        date,
        desc,
        amount: Math.round(amount*100)/100
      });

      document.getElementById("amount").value = "";
      document.getElementById("desc").value = "";

      save();
      render();
      toast("Movimiento a√±adido.", "ok");
    });

    document.getElementById("clearBtn").addEventListener("click", ()=>{
      if(!confirm("¬øSeguro que quieres borrar TODOS los movimientos?")) return;
      db = [];
      save();
      render();
      toast("Datos borrados.", "ok");
    });

    document.getElementById("exportBtn").addEventListener("click", ()=> refreshDbText(true));
    document.getElementById("importBtn").addEventListener("click", ()=> importFromText());

    document.getElementById("resetBtn").addEventListener("click", ()=>{
      db = [
        { id: uid(), type:"income", date: todayISO(), desc:"Ingreso demo", amount: 1800 },
        { id: uid(), type:"expense", date: todayISO(), desc:"Alquiler demo", amount: 700 },
        { id: uid(), type:"expense", date: todayISO(), desc:"Gasolina demo", amount: 60.25 }
      ];
      save();
      render();
      toast("Demo cargada.", "ok");
    });

    // ===== Init =====
    load();
    render();
  </script>
</body>
</html>
